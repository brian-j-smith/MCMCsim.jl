.. index:: Examples; Asthma: State Transitions in a Clinical Trial

.. _example-Asthma:

Asthma: State Transitions in a Clinical Trial
---------------------------------------------

An example from the BUGS book :cite:`lunn:2012:BUGS` concerning transitions between five clinical states in a randomized trial of treatments (seretide and fluticasone) for asthma.

Model
^^^^^

A discrete-time Markov model is fit (equivalent to four independent multinomial models) with probability vector :math:`q_i` governing the state in teh following week conditionally on the current state. The states are labelled STW: Sucessfully treated, UTW: Unsuccessfully treated, Hex: Hospital-managed exacerbation, Pex: Primary care-managed exacerbation, TF: Treatment failure. The fifth state, treatment failure, is absorbing (patients can't move out of it). The model is given by 

.. math::

    Y_i &\sim \text{Multinomial}(M_i, q_{i1},\ldots, q_{i5}) \\
    q_i &\sim \text{Dirichlet}(1,\ldots,1)

where :math:`Y_{ij}` is the number of transitions from state :math:`i` to state :math:`j`

Analysis Program
^^^^^^^^^^^^^^^^

.. literalinclude:: asthma.jl
    :language: julia

Results
^^^^^^^

.. code-block:: julia

    Iterations = 2501:10000
    Thinning interval = 1
    Chains = 1,2,3
    Samples per chain = 7500
    
    Empirical Posterior Estimates:
               Mean          SD         Naive SE         MCSE          ESS   
    q[1,1] 0.7647875473 0.0249375459 0.000166250306 0.001201252886  430.96156
    q[1,2] 0.2176077698 0.0240462134 0.000160308089 0.001159592192  430.01423
    q[1,3] 0.0033360856 0.0036340289 0.000024226859 0.000067134078 2930.15568
    q[1,4] 0.0071501490 0.0052830371 0.000035220247 0.000102394027 2662.06146
    q[1,5] 0.0071184483 0.0053445320 0.000035630214 0.000099995995 2856.63106
    q[2,1] 0.1186804890 0.0122131840 0.000081421227 0.000505586273  583.53546
    q[2,2] 0.8546727301 0.0132501515 0.000088334343 0.000547591235  585.50244
    q[2,3] 0.0011797901 0.0013039902 0.000008693268 0.000019007195 4706.65753
    q[2,4] 0.0065824875 0.0030395103 0.000020263402 0.000055137294 3038.89948
    q[2,5] 0.0188845034 0.0051861866 0.000034574577 0.000113208623 2098.63669
    q[3,1] 0.2883268452 0.1742035404 0.001161356936 0.004358121912 1597.77347
    q[3,2] 0.1426405382 0.1298817317 0.000865878211 0.002758067812 2217.61556
    q[3,3] 0.1426055101 0.1331451629 0.000887634420 0.003173686542 1760.04076
    q[3,4] 0.1431272622 0.1317544219 0.000878362813 0.002776341755 2252.08382
    q[3,5] 0.2832998442 0.1708229640 0.001138819760 0.004151765908 1692.88240
    
    Quantiles:
                2.5%          25.0%         50.0%        75.0%       97.5%   
    q[1,1] 0.714294527354 0.74814377317 0.7653219271 0.7809342510 0.815395378
    q[1,2] 0.168429265098 0.20192465952 0.2174106035 0.2335572165 0.265866891
    q[1,3] 0.000049810484 0.00080704498 0.0021628121 0.0046360017 0.012708282
    q[1,4] 0.000724086759 0.00324289200 0.0059364284 0.0097697017 0.020216254
    q[1,5] 0.000736729925 0.00319729938 0.0058311723 0.0096693937 0.021088448
    q[2,1] 0.094900010328 0.11047409937 0.1184133776 0.1266631249 0.143231937
    q[2,2] 0.828552715479 0.84575845996 0.8549109506 0.8634628566 0.880370440
    q[2,3] 0.000019708180 0.00027552364 0.0007457651 0.0016332892 0.004754409
    q[2,4] 0.002060360156 0.00430817638 0.0061023839 0.0083684373 0.013697482
    q[2,5] 0.010131684178 0.01513557470 0.0184966756 0.0220861720 0.030318067
    q[3,1] 0.034710447522 0.14924594732 0.2618549728 0.4050212012 0.674730666
    q[3,2] 0.002660408236 0.03994685991 0.1040390537 0.2114830193 0.474492827
    q[3,3] 0.002592522933 0.03911012457 0.1028615876 0.2086257470 0.495459023
    q[3,4] 0.002764729765 0.04058703497 0.1044186782 0.2083158802 0.482958727
    q[3,5] 0.036334167205 0.14668042226 0.2584334450 0.3917227848 0.671409346
